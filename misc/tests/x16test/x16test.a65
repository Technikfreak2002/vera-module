; x16test.a65

VIA1_BASE = $9F60
VIA1_ORB  = (VIA1_BASE + $0)
VIA1_ORA  = (VIA1_BASE + $1)
VIA1_DDRB = (VIA1_BASE + $2)
VIA1_DDRA = (VIA1_BASE + $3)

VIA2_BASE = $9F70
VIA2_ORB  = (VIA2_BASE + $0)
VIA2_ORA  = (VIA2_BASE + $1)
VIA2_DDRB = (VIA2_BASE + $2)
VIA2_DDRA = (VIA2_BASE + $3)

VERA_BASE = $9F20

VERA_ADDR_L   	  = (VERA_BASE + $00)
VERA_ADDR_M   	  = (VERA_BASE + $01)
VERA_ADDR_H   	  = (VERA_BASE + $02)
VERA_DATA0        = (VERA_BASE + $03)
VERA_DATA1        = (VERA_BASE + $04)
VERA_CTRL         = (VERA_BASE + $05)

VERA_IEN          = (VERA_BASE + $06)
VERA_ISR          = (VERA_BASE + $07)
VERA_IRQ_LINE_L   = (VERA_BASE + $08)

VERA_DC_VIDEO     = (VERA_BASE + $09)
VERA_DC_HSCALE    = (VERA_BASE + $0A)
VERA_DC_VSCALE    = (VERA_BASE + $0B)
VERA_DC_BORDER    = (VERA_BASE + $0C)

VERA_DC_HSTART    = (VERA_BASE + $09)
VERA_DC_HSTOP     = (VERA_BASE + $0A)
VERA_DC_VSTART    = (VERA_BASE + $0B)
VERA_DC_VSTOP     = (VERA_BASE + $0C)

VERA_L0_CONFIG    = (VERA_BASE + $0D)
VERA_L0_MAPBASE   = (VERA_BASE + $0E)
VERA_L0_TILEBASE  = (VERA_BASE + $0F)
VERA_L0_HSCROLL_L = (VERA_BASE + $10)
VERA_L0_HSCROLL_H = (VERA_BASE + $11)
VERA_L0_VSCROLL_L = (VERA_BASE + $12)
VERA_L0_VSCROLL_H = (VERA_BASE + $13)

VERA_L1_CONFIG    = (VERA_BASE + $14)
VERA_L1_MAPBASE   = (VERA_BASE + $15)
VERA_L1_TILEBASE  = (VERA_BASE + $16)
VERA_L1_HSCROLL_L = (VERA_BASE + $17)
VERA_L1_HSCROLL_H = (VERA_BASE + $18)
VERA_L1_VSCROLL_L = (VERA_BASE + $19)
VERA_L1_VSCROLL_H = (VERA_BASE + $1A)

VERA_AUDIO_CTRL   = (VERA_BASE + $1B)
VERA_AUDIO_RATE   = (VERA_BASE + $1C)
VERA_AUDIO_DATA   = (VERA_BASE + $1D)

VERA_SPI_DATA     = (VERA_BASE + $1E)
VERA_SPI_CTRL     = (VERA_BASE + $1F)


	* = $07FF
	.byte $01, $08, $0C, $08, $0A, $00, $9E, $20
	.byte $32, $30, $36, $34, $00, $00, $00, $00
	.byte $00
	* = $0810

	; sei

	; stz VERA_DATA1

	stz VERA_CTRL

	stz VERA_ADDR_L
	stz VERA_ADDR_M
	lda #$10
	sta VERA_ADDR_H

	ldy #$01
	lda #0
again:
	sta VERA_DATA0
	sty VERA_DATA0
	inc
	bne again



blaat:

	stz VERA_CTRL

	stz VERA_ADDR_L
	stz VERA_ADDR_M
	lda #$10
	sta VERA_ADDR_H

	lda #1
	sta VERA_CTRL

	stz VERA_ADDR_L
	lda #30
	sta VERA_ADDR_M
	lda #$10
	sta VERA_ADDR_H

	ldx #30
	ldy #0
again2:
	lda VERA_DATA0
	sta VERA_DATA1

	lda #1
	sta VERA_ISR


	iny
	bne again2
	dex
	bne again2




	stz VERA_CTRL

	stz VERA_ADDR_L
	stz VERA_ADDR_M
	stz VERA_ADDR_H

	inc VERA_DATA0
	inc VERA_ADDR_L
	inc VERA_ADDR_L
	inc VERA_DATA0
	inc VERA_ADDR_L
	inc VERA_ADDR_L
	inc VERA_DATA0
	inc VERA_ADDR_L
	inc VERA_ADDR_L
	inc VERA_DATA0


loop:	jmp blaat	
    	


; 	* = $C000
; reset_entry
; 	sei		; Disable IRQs
; 	cld		; Clear decimal mode
; 	lda #$01	; Configure VIA2 data direction
; 	sta VIA2_DDRB

; 	jsr delay

; 	lda #0
; 	sta VERA_CTRL

; 	lda #$11
; 	sta VERA_DC_VIDEO

; 	lda #1
; 	sta VERA_IEN

; 	cli

; loop
; 	; lda #$01
; 	; sta VIA2_ORB

; 	; jsr delay
; 	; lda #$00
; 	; sta VIA2_ORB
; 	; jsr delay

; 	; jsr wait_vsync
; 	; inc VERA_L0_HSCROLL_L
; 	jmp loop


; wait_vsync
; 	lda VERA_ISR
; 	and #$01
; 	beq wait_vsync
; 	sta VERA_ISR
; 	rts

; 	; Delay
; delay
; 	ldy #0
; inner_loop1
; 	ldx #0
; inner_loop2
; 	dex
; 	bne inner_loop2
; 	dey
; 	bne inner_loop1
; 	rts

; nmi_entry
; 	rti

; irq_entry
; 	pha

; 	lda #1
; 	sta VERA_ISR

; 	inc VERA_L0_HSCROLL_L

; 	nop
; 	nop
; 	nop
; 	nop
; 	nop
; 	nop
; 	nop
; 	nop

; 	nop
; 	nop
; 	nop
; 	nop
; 	nop
; 	nop
; 	nop
; 	nop

; 	pla
; 	rti

; 	.dsb $FFFA - *, $ff;
; 	.word nmi_entry
; 	.word reset_entry
; 	.word irq_entry
